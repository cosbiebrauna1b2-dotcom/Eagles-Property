<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dorothy - Property Consultation</title>
<style>
/* Basic Styles */
* { box-sizing: border-box; }
body { 
  margin:0; 
  font-family: Arial,sans-serif; 
  background:#fff; 
  color:#000; 
  overflow-x:hidden;
}
header { background:black; color:gold; padding:1.2rem; text-align:center; }
header h1 { margin:0; font-size:2rem; }
header p { margin:0.3rem 0 0; font-size:1rem; }

/* Hero */
.hero { position:relative; text-align:center; color:white; overflow:hidden; }
.hero img { width:100%; max-height:500px; object-fit:cover; filter:brightness(60%); transition:transform 1.5s ease; }
.hero:hover img { transform:scale(1.05); }
.hero-text { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; padding:0 1rem; }
.hero-text h2 { font-size:2rem; color:gold; margin-bottom:1rem; text-shadow:1px 1px 10px rgba(0,0,0,0.6); }
.hero-text button { padding:0.8rem 1.5rem; background:gold; color:black; border:none; border-radius:8px; font-size:1rem; cursor:pointer; transition:0.3s, box-shadow 0.6s; }
.hero-text button:hover { background:#d4af37; box-shadow:0 0 20px #d4af37; }

/* Modal */
.modal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.7); }
.modal-content { background:#000; margin:5% auto; padding:1.5rem; border-radius:12px; width:90%; max-width:500px; color:white; border:2px solid gold; }
.close { float:right; font-size:1.5rem; cursor:pointer; color:gold; }
input, textarea, button { width:100%; padding:0.75rem; margin:0.6rem 0; border-radius:5px; border:1px solid gold; background:#111; color:#fff; font-size:1rem; }
input:invalid { border-color:red; }
textarea { resize:vertical; }
button { background:gold; color:black; font-weight:bold; border:none; cursor:pointer; transition:0.3s, box-shadow 0.6s; }
button:hover { background:#d4af37; box-shadow:0 0 20px #d4af37; }
.success-message { text-align:center; color:gold; display:none; margin-top:1rem; }
.error-message { text-align:center; color:#ff6b6b; display:none; margin-top:0.5rem; }

/* Hidden Table */
.hidden-table { display:none; }
.table-container {
  width:100%;
  overflow-x:auto;
  margin-top:1rem;
}
table { width:100%; border-collapse:collapse; color:white; background:#111; min-width:400px; }
table, th, td { border:1px solid gold; padding:0.6rem; text-align:center; }
th { background:black; color:gold; }

/* Footer */
footer { background:black; color:gold; text-align:center; padding:1rem; margin-top:1rem; }

/* Media Queries */
@media(max-width:768px){
  header h1{font-size:1.6rem;}
  header p{font-size:0.9rem;}
  .hero-text h2{font-size:1.5rem;}
  .hero-text button{font-size:0.9rem; padding:0.6rem 1rem;}
}
@media(max-width:480px){
  .hero-text h2{font-size:1.2rem;}
  .hero-text button{font-size:0.85rem; padding:0.5rem 0.9rem;}
  table, th, td { font-size:0.8rem; }
}
</style>
</head>
<body>

<header>
<h1>Dorothy’s Property Consulting</h1>
<p>Helping you find the best properties in the UK</p>
</header>

<div class="hero">
<img src="https://images.unsplash.com/photo-1600585154340-be6161a56a0c" alt="UK property">
<div class="hero-text">
<h2>Invest in Your Dream Home Today</h2>
<button id="openFormBtn">Book a Free Consultation</button>
</div>
</div>

<div id="consultModal" class="modal">
<div class="modal-content">
<span class="close" id="closeFormBtn">&times;</span>
<h2 style="color: gold; text-align:center;">Book Your Free Consultation</h2>
<form id="bookingForm">
<input type="text" name="full_name" placeholder="Full Name" required>
<input type="email" name="email" placeholder="Email" required>
<input type="tel" name="phone" placeholder="Phone Number" required>
<textarea name="comment" placeholder="Comment (Optional)" rows="4"></textarea>
<button type="submit">Submit</button>
</form>
<p class="success-message" id="successMsg">Thank you! Your booking has been submitted.</p>
<p class="error-message" id="errorMsg">We couldn’t confirm the submission. We attempted a safe fallback. If you don’t get a confirmation email, please try again.</p>
</div>
</div>

<!-- Hidden submissions table (for admin/debug only) -->
<div class="hidden-table">
  <h2 class="section-title">Submitted Bookings</h2>
  <div class="table-container">
    <table id="submissionsTable">
      <thead>
        <tr>
          <th>Full Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Comment</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</div>

<footer>
<p>© 2025 Dorothy’s Property Consulting | Designed with ♥</p>
</footer>

<script>
const ZAPIER_WEBHOOK = 'https://hooks.zapier.com/hooks/catch/23572733/utq04zu/';

// Modal logic
const modal = document.getElementById("consultModal");
const openBtn = document.getElementById("openFormBtn");
const closeBtn = document.getElementById("closeFormBtn");
openBtn.onclick = () => modal.style.display="block";
closeBtn.onclick = () => modal.style.display="none";
window.onclick = (e) => { if(e.target==modal) modal.style.display="none"; }

// Helpers
function addRowToTable(data) {
  const tbody = document.querySelector('#submissionsTable tbody');
  const row = document.createElement('tr');
  row.innerHTML = `
    <td>${data.full_name}</td>
    <td>${data.email}</td>
    <td>${data.phone}</td>
    <td>${data.comment || ''}</td>
  `;
  tbody.appendChild(row);
}

function sendWithBeaconOrFallback(data) {
  try {
    const payload = JSON.stringify(data);
    const blob = new Blob([payload], { type: 'text/plain;charset=UTF-8' });
    const ok = navigator.sendBeacon && navigator.sendBeacon(ZAPIER_WEBHOOK, blob);

    if (ok) {
      return Promise.resolve({ ok: true, via: 'beacon' });
    }
  } catch (e) {}

  try {
    const fd = new FormData();
    Object.entries(data).forEach(([k,v]) => fd.append(k, v ?? ''));
    return fetch(ZAPIER_WEBHOOK, {
      method: 'POST',
      mode: 'no-cors',
      body: fd,
      credentials: 'omit',
      keepalive: true
    }).then(() => ({ ok: true, via: 'fallback' }))
      .catch(() => ({ ok: false }));
  } catch (e2) {
    return Promise.resolve({ ok: false });
  }
}

// Form submission
const form = document.getElementById('bookingForm');
const successMsg = document.getElementById('successMsg');
const errorMsg = document.getElementById('errorMsg');

form.addEventListener('submit', async (e)=>{
  e.preventDefault();
  successMsg.style.display = 'none';
  errorMsg.style.display = 'none';

  const data = Object.fromEntries(new FormData(form).entries());

  // ✅ Fix for Google Sheets formula parse error with +country codes
  if (data.phone && data.phone.startsWith("+")) {
    data.phone = "'" + data.phone; 
  }

  // Add to hidden admin table
  addRowToTable(data);

  const btn = form.querySelector('button[type="submit"]');
  const orig = btn.textContent;
  btn.disabled = true; btn.textContent = 'Submitting...';

  const result = await sendWithBeaconOrFallback(data);

  btn.disabled = false; btn.textContent = orig;

  if (result.ok) {
    successMsg.style.display = 'block';
    if (result.via === 'fallback') {
      errorMsg.style.display = 'block';
      errorMsg.textContent = 'Submitted via a safe fallback. If you don’t see it in Zapier, please test your webhook trigger.';
    }
    form.reset();
  } else {
    errorMsg.style.display = 'block';
  }
});

// Optional: admin toggle (Ctrl+Alt+D) to show the hidden table
document.addEventListener('keydown', (e) => {
  if (e.ctrlKey && e.altKey && e.key.toLowerCase() === 'd') {
    const wrap = document.querySelector('.hidden-table');
    wrap.style.display = (wrap.style.display === 'none' || !wrap.style.display) ? 'block' : 'none';
  }
});
</script>

</body>
</html>
